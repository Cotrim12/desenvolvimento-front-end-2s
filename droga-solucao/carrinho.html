<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrinho - Droga SoluÃ§Ã£o</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body { background:#0f0f0f; color:white; font-family: Arial; padding:20px; }
  .box { background:#1a1a1a; padding:15px; border-radius:12px; margin-bottom:15px; display:flex; }
  .item-img { width:80px; height:80px; object-fit:contain; background:#fff; border-radius:8px; }
  .qty-btn { width:32px; height:32px; border:none; background:#00b140; color:#000; font-weight:bold; border-radius:6px; }
  .remove-btn { color:#ff6b6b; cursor:pointer; font-size:14px; }
  .total-box { background:#111; padding:15px; border-radius:12px; margin-top:20px; }

  /* Alerta bonito */
  .alertBox {
    background: #ff3b3b;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    margin-bottom: 15px;
    display: none;
  }
</style>
</head>
<body>

<h2>Carrinho ðŸ›’</h2>

<div id="alerta" class="alertBox">âš  Seu carrinho estÃ¡ vazio!</div>

<div id="cartContainer"></div>

<!-- RESUMO FINAL -->
<div class="total-box">
  <h4>Resumo do pedido</h4>
  <p>Subtotal: <b id="subtotal">R$ 0,00</b></p>

  <button class="btn btn-primary w-100 mb-2" onclick="window.location.href='frete.html'">
    Calcular Frete
  </button>

  <button class="btn btn-success w-100 mb-2" onclick="finalizar()">Ir para o pagamento</button>

  <button class="btn btn-outline-light w-100" onclick="window.location.href='page13.html'">
    Continuar comprando
  </button>
</div>

<script>
function formatPrice(n){
  return "R$ " + n.toFixed(2).replace(".", ",");
}

function carregarCarrinho(){
  const produtos = JSON.parse(localStorage.getItem("produtos") || "[]");
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const container = document.getElementById("cartContainer");
  container.innerHTML = "";

  let subtotal = 0;

  cart.forEach(item => {
    const prod = produtos.find(p => p.id === item.id);
    if(!prod) return;

    const preco = Number(prod.preco);
    const totalItem = preco * item.qtd;
    subtotal += totalItem;

    const div = document.createElement("div");
    div.className = "box";
    div.innerHTML = `
      <img src="${prod.imagem}" class="item-img">

      <div class="ms-3 w-100">
        <h5>${prod.nome}</h5>
        <b>${formatPrice(preco)}</b>

        <div class="d-flex align-items-center mt-2">
          <button class="qty-btn" onclick="alterarQtd(${item.id}, -1)">âˆ’</button>
          <span class="mx-3">${item.qtd}</span>
          <button class="qty-btn" onclick="alterarQtd(${item.id}, 1)">+</button>
        </div>

        <p class="text-success mt-1">Subtotal: ${formatPrice(totalItem)}</p>

        <span class="remove-btn" onclick="remover(${item.id})">Remover</span>
      </div>
    `;
    container.appendChild(div);
  });

  document.getElementById("subtotal").innerText = formatPrice(subtotal);
}

function alterarQtd(id, valor){
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const item = cart.find(i => i.id === id);

  item.qtd += valor;
  if(item.qtd <= 1) item.qtd = 1;

  localStorage.setItem("cart", JSON.stringify(cart));
  carregarCarrinho();
}

function remover(id){
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  cart = cart.filter(i => i.id !== id);
  localStorage.setItem("cart", JSON.stringify(cart));
  carregarCarrinho();
}

/* -------------------- BLOQUEIO DE CARRINHO VAZIO -------------------- */
function finalizar(){
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");

  if(cart.length === 0){
    const alerta = document.getElementById("alerta");
    alerta.style.display = "block";

    setTimeout(() => {
      alerta.style.display = "none";
    }, 3000);

    return; // Impede de ir para payment.html
  }

  window.location.href = "payment.html";
}

carregarCarrinho();
</script>

</body>
</html>
