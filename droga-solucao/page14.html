<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Produto - Droga Solu√ß√£o</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body{
    background:#0f0f0f;
    color:#fff;
    font-family:Arial, sans-serif;
    margin:0;
    padding:20px;
  }

  /* Header com √≠cone de atendimento */
  .header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px 5px;
    margin-bottom:10px;
  }

  .att-icon {
    font-size:24px;
    cursor:pointer;
    text-decoration:none;
    color:white;
  }

  .img-wrap{
    width:100%;
    max-width:330px;
    margin:0 auto;
    display:block;
  }

  .price{ color:#00b140; font-weight:700; font-size:22px; }

  .qty-btn{
    width:42px;
    height:42px;
    border-radius:8px;
    background:#1a1a1a;
    border:none;
    color:#fff;
    font-size:22px;
  }

  .fav{
    font-size:22px;
    cursor:pointer;
    color:#999;
  }
  .fav.active{ color:#ff6b6b; }
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <a href="page13.html" style="color:#ccc; font-size:22px; text-decoration:none;">‚Üê</a>

  <a href="atendimento.html" class="att-icon">üí¨</a>
</div>

<div class="text-center mt-3">

  <img id="imgProd" src="" class="img-wrap" alt="produto" style="background:#0b0b0b;padding:12px;border-radius:12px">

  <div class="d-flex justify-content-between align-items-center mt-3 mb-2 px-2">
    <h4 id="nomeProd"></h4>
    <span id="favBtn" class="fav">‚ô°</span>
  </div>

  <div id="av" class="text-muted small mb-2"></div>
  <p id="desc" class="text-secondary small px-2"></p>

  <!-- Quantidade -->
  <div class="d-flex justify-content-center align-items-center gap-2 my-3">
    <button id="menos" class="qty-btn">‚àí</button>
    <div id="qtd" style="min-width:30px;text-align:center;font-size:20px;">1</div>
    <button id="mais" class="qty-btn">+</button>
  </div>

  <div class="price mb-3" id="preco">R$0,00</div>

  <div class="d-grid gap-2" style="max-width:300px;margin:0 auto">
    <button id="addCart" class="btn btn-success">Adicionar ao carrinho</button>
    <button id="buyNow" class="btn btn-outline-light">Comprar agora</button>
  </div>

</div>


<script>
function formatPrice(n){
  return 'R$ ' + n.toFixed(2).replace('.',',');
}

const params = new URLSearchParams(window.location.search);
const id = Number(params.get('id'));

const produtos = JSON.parse(localStorage.getItem('produtos') || '[]');
const prod = produtos.find(p => p.id === id);

if(!prod){
  document.body.innerHTML = "<div style='padding:20px;'>Produto n√£o encontrado.<br><br><a href='page13.html' style='color:#0f0;'>Voltar</a></div>";
  throw "Produto n√£o encontrado";
}

/* Preenche dados */
document.getElementById("imgProd").src = prod.imagem;
document.getElementById("nomeProd").innerText = prod.nome;
document.getElementById("desc").innerText = prod.descricao || "";
document.getElementById("av").innerText = `‚≠ê ${prod.avaliacao || 4.5} ‚Ä¢ ${prod.tempo || "20 mins"}`;
document.getElementById("preco").innerText = formatPrice(prod.preco);

/* Quantidade */
let qtd = 1;
document.getElementById("qtd").innerText = qtd;

document.getElementById("mais").onclick = () => {
  qtd++;
  document.getElementById("qtd").innerText = qtd;
};

document.getElementById("menos").onclick = () => {
  if(qtd > 1){ qtd--; }
  document.getElementById("qtd").innerText = qtd;
};

/* Favoritos */
function getFavs(){ return JSON.parse(localStorage.getItem("favoritos") || "[]"); }
function setFavs(a){ localStorage.setItem("favoritos", JSON.stringify(a)); }

const favBtn = document.getElementById("favBtn");

function refreshFav(){
  const favs = getFavs();
  const active = favs.includes(prod.id);

  favBtn.classList.toggle("active", active);
  favBtn.innerText = active ? "‚ô•" : "‚ô°";
}

favBtn.onclick = () => {
  const favs = getFavs();
  if(favs.includes(prod.id)){
    setFavs(favs.filter(x => x !== prod.id));
  } else {
    favs.push(prod.id);
    setFavs(favs);
  }
  refreshFav();
};

refreshFav();

/* Adicionar ao carrinho */
document.getElementById("addCart").onclick = () => {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");

  const found = cart.find(i => i.id === prod.id);
  if(found){
    found.qtd += qtd;
  } else {
    cart.push({id: prod.id, qtd});
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Adicionado ao carrinho!");
};

/* Comprar agora ‚Üí direto para frete.html */
document.getElementById("buyNow").onclick = () => {
  
  // adiciona item no carrinho para continuar fluxo normal
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const found = cart.find(i => i.id === prod.id);

  if(found) found.qtd += qtd;
  else cart.push({id: prod.id, qtd});

  localStorage.setItem("cart", JSON.stringify(cart));

  window.location.href = "frete.html";
};
</script>

</body>
</html>
