<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Painel Funcionário - Droga Solução</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>body{background:#0f0f0f;color:#fff;font-family:Inter;padding:16px} .card{background:#151515;border-radius:10px;padding:12px;margin-bottom:12px}</style>
</head>
<body>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <a href="page4.html" style="color:#ccc;text-decoration:none">← Sair</a>
    <h5>Painel do Funcionário</h5>
    <div></div>
  </div>

  <h6>Receitas enviadas</h6>
  <div id="receitas"></div>

  <h6 class="mt-3">Estoque da unidade</h6>
  <div id="estoque"></div>

<script>
  const user = JSON.parse(localStorage.getItem('user')||'{}');
  if(!user || user.role !== 'funcionario'){ alert('Acesso negado. Faça login como funcionário.'); window.location.href='page4.html'; }

  // receitas (array de objetos {id, cliente, arquivo, status})
  const receitas = JSON.parse(localStorage.getItem('receitas') || '[]');
  const receitasDiv = document.getElementById('receitas');
  if(!receitas.length) receitasDiv.innerHTML = '<div class="card">Nenhuma receita enviada.</div>';
  else receitas.forEach(r=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<div><strong>${r.cliente}</strong> - ${r.data || ''}</div>
                   <div class="text-muted small">Status: ${r.status || 'Pendente'}</div>
                   <div class="mt-2"><button class="btn btn-sm btn-success" onclick="ver(${r.id})">Verificar</button>
                   <button class="btn btn-sm btn-secondary" onclick="marcar(${r.id})">Marcar como processada</button></div>`;
    receitasDiv.appendChild(d);
  });

  function ver(id){ alert('Abrir receita ID '+id); }
  function marcar(id){
    const arr = receitas.map(r=> r.id===id? {...r, status:'Processada'}: r);
    localStorage.setItem('receitas', JSON.stringify(arr));
    alert('Receita marcada como processada'); location.reload();
  }

  // estoque
  const produtos = JSON.parse(localStorage.getItem('produtos')||'[]');
  const estoqueDiv = document.getElementById('estoque');
  if(!produtos.length) estoqueDiv.innerHTML = '<div class="card">Sem produtos</div>';
  else produtos.forEach(p=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="d-flex justify-content-between align-items-center">
      <div><strong>${p.nome}</strong><div class="small text-muted">${p.descricao||''}</div></div>
      <div style="text-align:right">
        <div>Estoque: <input type="number" value="${p.stock||0}" min="0" id="stock-${p.id}" style="width:72px" /></div>
        <div class="mt-2"><button class="btn btn-sm btn-primary" onclick="updateStock(${p.id})">Salvar</button></div>
      </div>
    </div>`;
    estoqueDiv.appendChild(el);
  });

  function updateStock(id){
    const inp = document.getElementById('stock-'+id);
    const val = Number(inp.value);
    const arr = JSON.parse(localStorage.getItem('produtos')||'[]');
    const idx = arr.findIndex(x=>x.id===id);
    if(idx>=0){ arr[idx].stock = val; localStorage.setItem('produtos', JSON.stringify(arr)); alert('Estoque atualizado'); }
  }
</script>
</body>
</html>
