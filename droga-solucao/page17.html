<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - Droga Solução</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>body{background:#0f0f0f;color:#fff;font-family:Inter;padding:16px} .card{background:#151515;border-radius:10px;padding:12px;margin-bottom:12px}</style>
</head>
<body>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <a href="page4.html" style="color:#ccc;text-decoration:none">← Sair</a>
    <h5>Painel do Administrador</h5>
    <div></div>
  </div>

  <h6>Estatísticas</h6>
  <div id="stats" class="card mb-3"></div>

  <h6>Cadastrar novo produto</h6>
  <div class="card mb-3">
    <input id="pNome" class="form-control mb-2" placeholder="Nome">
    <input id="pPreco" class="form-control mb-2" placeholder="Preço" type="number" step="0.01">
    <input id="pImg" class="form-control mb-2" placeholder="Caminho da imagem (ex: img/ex.png)">
    <input id="pStock" class="form-control mb-2" placeholder="Estoque" type="number">
    <button class="btn btn-success w-100" onclick="addProd()">Cadastrar</button>
  </div>

  <h6>Gerenciar estoque</h6>
  <div id="manage" class="card"></div>

<script>
  const user = JSON.parse(localStorage.getItem('user')||'{}');
  if(!user || user.role !== 'administrador'){ alert('Acesso negado. Faça login como administrador.'); window.location.href='page4.html'; }

  function getProducts(){ return JSON.parse(localStorage.getItem('produtos')||'[]'); }
  function setProducts(a){ localStorage.setItem('produtos', JSON.stringify(a)); }

  function getSales(){ return JSON.parse(localStorage.getItem('sales')||'{}'); }

  function renderStats(){
    const prods = getProducts();
    const sales = getSales();
    let totalSold = Object.values(sales).reduce((s,n)=>s+(n||0),0);
    document.getElementById('stats').innerHTML = `<div>Total de produtos cadastrados: <strong>${prods.length}</strong></div>
      <div>Total vendido (itens): <strong>${totalSold}</strong></div>`;
  }

  function addProd(){
    const nome = document.getElementById('pNome').value.trim();
    const preco = parseFloat(document.getElementById('pPreco').value||0);
    const img = document.getElementById('pImg').value.trim() || 'img/default.png';
    const stock = parseInt(document.getElementById('pStock').value||0);
    if(!nome){ alert('Nome obrigatório'); return; }
    const arr = getProducts();
    const newId = arr.length ? Math.max(...arr.map(x=>x.id))+1 : 1;
    arr.push({id:newId,nome,preco,imagem:img,descricao:'',stock,avaliacao:4.5});
    setProducts(arr);
    alert('Produto cadastrado'); renderManage(); renderStats();
  }

  function renderManage(){
    const arr = getProducts();
    const container = document.getElementById('manage');
    container.innerHTML = arr.map(p=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div><strong>${p.nome}</strong><div class="small text-muted">Estoque: ${p.stock||0} • R$${(p.preco||0).toFixed(2)}</div></div>
      <div>
        <button class="btn btn-sm btn-primary" onclick="edit(${p.id})">Editar</button>
        <button class="btn btn-sm btn-danger" onclick="removeProd(${p.id})">Remover</button>
      </div>
    </div>`).join('');
  }

  function edit(id){
    const arr = getProducts();
    const idx = arr.findIndex(x=>x.id===id);
    if(idx<0) return;
    const novo = prompt('Novo estoque (enter para manter):', arr[idx].stock||0);
    if(novo !== null){ arr[idx].stock = Number(novo); setProducts(arr); renderManage(); renderStats(); }
  }

  function removeProd(id){ if(!confirm('Remover produto?')) return; let arr = getProducts(); arr = arr.filter(x=>x.id!==id); setProducts(arr); renderManage(); renderStats(); }

  renderManage(); renderStats();
</script>
</body>
</html>
