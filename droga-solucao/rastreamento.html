<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rastreamento do Pedido</title>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.css" />

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: #0f0f0f;
        color: white;
        font-family: Arial, sans-serif;
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }

    .header {
        width: 100%;
        text-align: center;
        margin-bottom: 30px;
    }

    .header h2 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .header p {
        font-size: 14px;
        color: #aaa;
    }

    .timeline {
        flex: 1;
        min-width: 300px;
        max-width: 400px;
        background: #1a1a1a;
        padding: 25px;
        border-radius: 8px;
        border: 1px solid #333;
    }

    .mapa-container {
        flex: 1;
        min-width: 300px;
        background: #1a1a1a;
        border-radius: 8px;
        border: 1px solid #333;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 177, 64, 0.2);
    }

    #mapa {
        width: 100%;
        height: 600px;
    }

    .etapa {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 18px 0;
    }

    .bolinha {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        border: 3px solid #444;
        background: transparent;
        transition: 0.3s;
        flex-shrink: 0;
    }

    .bolinha.ativa {
        background: #00b140;
        border-color: #00b140;
        box-shadow: 0 0 10px #00b140;
    }

    .linha {
        width: 3px;
        height: 28px;
        background: #444;
        margin-left: 10px;
    }

    .etapa span {
        font-size: 14px;
        color: #ccc;
    }

    .status-info {
        margin-top: 20px;
        padding: 15px;
        background: rgba(0, 177, 64, 0.1);
        border-left: 3px solid #00b140;
        border-radius: 4px;
        text-align: left;
        font-size: 13px;
    }

    .status-info .etapa-atual {
        font-weight: bold;
        color: #00b140;
        margin-bottom: 5px;
    }

    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }

        #mapa {
            height: 400px;
        }

        .timeline {
            max-width: 100%;
        }
    }

    .leaflet-popup-content-wrapper {
        background: #1a1a1a;
        color: white;
        border-radius: 8px;
    }

    .leaflet-popup-content {
        color: white;
    }

    .leaflet-popup-tip {
        background: #1a1a1a;
    }

    @keyframes pulso {
        0%, 100% {
            transform: scale(1);
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }
        50% {
            transform: scale(1.3);
            filter: drop-shadow(0 0 15px rgba(0, 177, 64, 0.8));
        }
    }

    .icone-ativo {
        animation: pulso 0.6s ease-in-out;
    }

    @keyframes highlight {
        0%, 100% {
            filter: brightness(1);
        }
        50% {
            filter: brightness(1.5);
        }
    }

    .icone-destaque {
        animation: highlight 1s ease-in-out infinite;
    }

</style>
</head>

<body>

<div class="header">
    <h2>üöö Rastreamento do Pedido</h2>
    <p>Acompanhe o progresso do seu pedido em tempo real</p>
</div>

<div class="container">

    <!-- Timeline -->
    <div class="timeline">
        <h3 style="margin-bottom: 20px; color: #00b140;">Status da Entrega</h3>

        <div class="etapa">
            <div id="b1" class="bolinha"></div>
            <span>Pedido feito</span>
        </div>
        <div class="linha"></div>

        <div class="etapa">
            <div id="b2" class="bolinha"></div>
            <span>Pagamento confirmado</span>
        </div>
        <div class="linha"></div>

        <div class="etapa">
            <div id="b3" class="bolinha"></div>
            <span>Separando pedido</span>
        </div>
        <div class="linha"></div>

        <div class="etapa">
            <div id="b4" class="bolinha"></div>
            <span>Seu pedido saiu para entrega</span>
        </div>
        <div class="linha"></div>

        <div class="etapa">
            <div id="b5" class="bolinha"></div>
            <span>O entregador chegou</span>
        </div>
        <div class="linha"></div>

        <div class="etapa">
            <div id="b6" class="bolinha"></div>
            <span>Pedido finalizado</span>
        </div>

        <div class="status-info">
            <div class="etapa-atual" id="etapaAtual">Etapa atual: Pedido feito</div>
            <div id="proximaEtapa">Pr√≥xima etapa em breve...</div>
        </div>
    </div>

    <!-- Mapa -->
    <div class="mapa-container">
        <div id="mapa"></div>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.umd.js"></script>

<script>
    const locais = {
        farmacia: { lat: -15.7797, lng: -47.8822, nome: "Farm√°cia Central" },
        estoque: { lat: -15.7942, lng: -47.8858, nome: "Centro de Distribui√ß√£o" },
        entrega1: { lat: -15.7675, lng: -47.8700, nome: "Ponto 1 - Asa Sul" },
        entrega2: { lat: -15.7550, lng: -47.8900, nome: "Ponto 2 - Asa Norte" },
        endereco: { lat: -15.8267, lng: -47.8822, nome: "Seu Endere√ßo - Bras√≠lia" }
    };

    const etapas = [
        { bolinha: "b1", tempo: 500, local: "farmacia", descricao: "Pedido feito na farm√°cia" },
        { bolinha: "b2", tempo: 1500, local: "farmacia", descricao: "Pagamento confirmado" },
        { bolinha: "b3", tempo: 3000, local: "estoque", descricao: "Separando pedido no dep√≥sito" },
        { bolinha: "b4", tempo: 4500, local: "entrega1", descricao: "Saiu para entrega - Rota iniciada" },
        { bolinha: "b5", tempo: 6000, local: "entrega2", descricao: "Entregador se movendo para seu endere√ßo" },
        { bolinha: "b6", tempo: 7500, local: "endereco", descricao: "Pedido finalizado!" }
    ];

    let mapa;
    let marcadores = {};
    let rotaAtual = null;
    let etapaAtualIdx = 0;
    let marcadorAtivo = null;


    function atualizarIconeLocal(nomeLocal) {

        if (marcadorAtivo) {
            const elementoAnterior = marcadorAtivo._icon;
            if (elementoAnterior) {
                elementoAnterior.classList.remove('icone-destaque');
            }
        }

        if (marcadores[nomeLocal]) {
            marcadorAtivo = marcadores[nomeLocal];
            const elemento = marcadorAtivo._icon;
            if (elemento) {
                elemento.classList.add('icone-destaque');
            }
        }
    }


    function inicializarMapa() {
        mapa = L.map('mapa').setView([-15.7897, -47.8822], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19,
            className: 'mapa-tiles'
        }).addTo(mapa);


        Object.keys(locais).forEach(key => {
            const local = locais[key];
            const icone = criarIcone(key);
            marcadores[key] = L.marker([local.lat, local.lng], { icon: icone })
                .bindPopup(`<b>${local.nome}</b>`)
                .addTo(mapa);
        });
    }

    function criarIcone(tipo) {
        const cores = {
            farmacia: '#FF6B6B',
            estoque: '#4ECDC4',
            entrega1: '#95E1D3',
            entrega2: '#95E1D3',
            endereco: '#00b140'
        };

        const nomes = {
            farmacia: 'üè•',
            estoque: 'üì¶',
            entrega1: 'üöó',
            entrega2: 'üöó',
            endereco: 'üè†'
        };

        return L.divIcon({
            className: 'custom-icon',
            html: `<div style="
                background: ${cores[tipo]};
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                border: 3px solid white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            ">${nomes[tipo]}</div>`,
            iconSize: [40, 40]
        });
    }

    function animarMovimento(deLocal, paraLocal) {
        if (rotaAtual) {
            mapa.removeControl(rotaAtual);
        }

        const de = locais[deLocal];
        const para = locais[paraLocal];

        rotaAtual = L.Routing.control({
            waypoints: [
                L.latLng(de.lat, de.lng),
                L.latLng(para.lat, para.lng)
            ],
            lineOptions: {
                styles: [
                    { color: '#00b140', opacity: 0.8, weight: 4, dashArray: '5, 5' }
                ]
            },
            show: false,
            addWaypoints: false,
            routeWhileDragging: false,
            draggableWaypoints: false,
            fitSelectedRoutes: true,
            showAlternatives: false
        }).addTo(mapa);

        mapa.fitBounds(rotaAtual.getBounds());
    }

    function atualizarStatus(etapaIdx) {
        const etapa = etapas[etapaIdx];
        const etapaAtualEl = document.getElementById('etapaAtual');
        const proximaEtapaEl = document.getElementById('proximaEtapa');

        etapaAtualEl.textContent = `Etapa atual: ${etapa.descricao}`;

        if (etapaIdx < etapas.length - 1) {
            proximaEtapaEl.textContent = `Pr√≥xima: ${etapas[etapaIdx + 1].descricao}`;
        } else {
            proximaEtapaEl.textContent = 'Entrega conclu√≠da com sucesso! ‚úì';
            proximaEtapaEl.style.color = '#00b140';
        }

        // Atualizar √≠cone no mapa
        atualizarIconeLocal(etapa.local);
    }


    function ativarBolinha(id) {
        document.getElementById(id).classList.add("ativa");
    }


    function executarRastreamento() {
        inicializarMapa();

        etapas.forEach((etapa, idx) => {
            setTimeout(() => {
                ativarBolinha(etapa.bolinha);
                etapaAtualIdx = idx;
                atualizarStatus(idx);

                if (idx > 0) {
                    const etapaAnterior = etapas[idx - 1];
                    animarMovimento(etapaAnterior.local, etapa.local);
                } else {
                    mapa.setView([locais.farmacia.lat, locais.farmacia.lng], 14);
                }
            }, etapa.tempo);
        });

        setTimeout(() => {
            window.location.href = "historico.html";
        }, 9500);
    }

    document.addEventListener('DOMContentLoaded', executarRastreamento);
</script>

</body>
</html>
